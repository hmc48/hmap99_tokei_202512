<!DOCTYPE html>
<html lang="ja">
<head>

<!-- GA4ã®è¨ˆæ¸¬ã‚¿ã‚° -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-R23Q109BZT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-R23Q109BZT');
</script>

<meta charset="utf-8">
<title>åŒ»ç™‚ãƒ»ä»‹è­·æ–½è¨­ãƒãƒƒãƒ—</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<style>
body { margin:0; padding:0; overflow:hidden; font-family: sans-serif; }
#map { height:100vh; width:100vw; z-index:1; }
#map-title-bar {
  position: fixed; top: 10px; left: 10px; z-index: 4000;
  background: #ffe4e1; padding: 5px 12px; border-radius: 4px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3); color: black;
  display: flex; align-items: baseline; white-space: nowrap; pointer-events: none;
}
#main-title { font-size: 9pt; font-weight: bold; margin-right: 10px; }
#credit-title { font-size: 7pt; font-weight: bold; margin-right: 10px; }
#zoom-indicator {
  position: fixed; bottom: 10px; right: 10px; z-index: 4000;
  background: rgba(255, 255, 255, 0.8); padding: 5px 10px;
  border: 1px solid #ccc; border-radius: 4px; font-weight: bold; font-size: 14px; pointer-events: none;
}
.circle-btn {
  width:48px; height:48px; border-radius:50%; text-align:center; line-height:48px;
  box-shadow:0 2px 8px rgba(0,0,0,0.3); cursor:pointer; font-size:24px; z-index:2000;
  position:fixed; background:white;
}
#control-btn { top:15px; right:15px; background:#007bff; color:white; }
#search-btn { top:75px; right:15px; background:#28a745; color:white; }
#info-btn { top:135px; right:15px; background:#ff69b4; color:white; }
#controls, #search-panel, #info-panel {
  display:none; position:fixed; right:15px; width:220px; 
  background:white; padding:15px; border-radius:8px; z-index:2000;
  max-height:75vh; overflow-y:auto; box-shadow:0 4px 15px rgba(0,0,0,0.2);
}
#controls { top:70px; }
#search-panel { top:130px; }
#info-panel { bottom:20px; left:20px; right:20px; width:auto; font-size:14px; z-index:3000; }
.close-x { float: right; font-size: 30px; font-weight: bold; cursor: pointer; color: #888; }
.section-title { font-weight:bold; margin-top:10px; border-bottom:1px solid #eee; }
.layer-item { margin-bottom: 8px; font-size: 14px; display: flex; align-items: center; }
input[type="checkbox"], input[type="radio"] { margin-right: 10px; transform: scale(1.2); }
button.menu-sub-btn { margin: 5px 1%; padding: 8px; width: 46%; font-size: 11px; }
/* --- ã“ã“ã‚’ä¿®æ­£ï¼šãƒœã‚¿ãƒ³ã‚’æ¨ªä¸¦ã³ã«ã™ã‚‹è¨­å®š --- */
.btn-container { display: flex; gap: 5px; margin-bottom: 5px; }
button.menu-sub-btn { flex: 1; padding: 8px; font-size: 11px; cursor: pointer; }
/* -------------------------------------- */
.search-item:hover { background:#f0f0f0; cursor:pointer; }
</style>
</head>
<body>
  <div id="map-title-bar"><span id="main-title">å…¨å›½ç‰ˆ</span> <span id="credit-title">Â© OpenStreetMap</span></div>
  <div id="zoom-indicator">Zoom: --</div>

  <div id="control-btn" class="circle-btn" onclick="togglePanel('controls')">ğŸ› ï¸</div>
  <div id="controls">
    <span class="close-x" onclick="togglePanel('controls')">Ã—</span>
    <div class="section-title">ä¸€æ‹¬æ“ä½œ</div>
    <div class="btn-container">
      <button class="menu-sub-btn" id="selectAllBtn">å…¨ã¦é¸æŠ</button>
      <button class="menu-sub-btn" id="deselectAllBtn">å…¨ã¦è§£é™¤</button>
    </div>
    <div class="section-title">åœ°å›³ã®ç¨®é¡</div>
    <label class="layer-item"><input type="radio" name="baseLayer" value="æ¨™æº–" checked> ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ãƒˆãƒªãƒ¼ãƒˆãƒãƒƒãƒ—</label>
    <label class="layer-item"><input type="radio" name="baseLayer" value="èˆªç©ºå†™çœŸ"> èˆªç©ºå†™çœŸ(å›½åœŸåœ°ç†é™¢)</label>
    <label class="layer-item"><input type="radio" name="baseLayer" value="å›½åœŸåœ°ç†é™¢åœ°å›³"> å›½åœŸåœ°ç†é™¢åœ°å›³</label>
    <div class="section-title">å¢ƒç•Œç·šãƒ»æ–½è¨­ç¨®é¡</div>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ä¸€èˆ¬ç—…åºŠãŒ500åºŠä»¥ä¸Šã®ç—…é™¢"> ä¸€èˆ¬ç—…åºŠãŒ500åºŠä»¥ä¸Šã®ç—…é™¢</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç™‚é¤Šç—…åºŠãŒ100åºŠä»¥ä¸Šã®ç—…é™¢"> ç™‚é¤Šç—…åºŠãŒ100åºŠä»¥ä¸Šã®ç—…é™¢</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="ç²¾ç¥ç—…åºŠãŒ200åºŠä»¥ä¸Šã®ç—…é™¢"> ç²¾ç¥ç—…åºŠãŒ200åºŠä»¥ä¸Šã®ç—…é™¢</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="çµæ ¸ç—…åºŠãŒã‚ã‚‹ç—…é™¢"> çµæ ¸ç—…åºŠãŒã‚ã‚‹ç—…é™¢</label>
    <label class="layer-item"><input type="checkbox" class="layer-toggle" value="æ„ŸæŸ“ç—…åºŠãŒã‚ã‚‹ç—…é™¢"> æ„ŸæŸ“ç—…åºŠãŒã‚ã‚‹ç—…é™¢</label>

  </div>
  <div id="search-btn" class="circle-btn" onclick="togglePanel('search-panel')">ğŸ”</div>
  <div id="search-panel">
    <input type="text" id="search-input" placeholder="andæ¤œç´¢ï¼ˆä¾‹ï¼šå†…ç§‘ äº”åç”°ï¼‰" style="width:100%; padding:10px; box-sizing:border-box;">
    <div id="search-results" style="max-height:200px; overflow-y:auto; margin-top:10px;"></div>
  </div>
  <div id="info-btn" class="circle-btn" onclick="togglePanel('info-panel')">i</div>
  <div id="info-panel" onclick="this.style.display='none'">
    <strong>åŒ»ç™‚ãƒ»ä»‹è­·æ–½è¨­ãƒãƒƒãƒ—ã€€ã€€ã€€ã€€â˜…é–‰ã˜ã‚‹â˜…</strong><br>
    <span style="color:red;">â˜…</span>ä¸€èˆ¬ç—…åºŠãŒ500åºŠä»¥ä¸Šã®ç—…é™¢
    <span style="color:blue;">&hearts;</span>ç™‚é¤Šç—…åºŠãŒ100åºŠä»¥ä¸Šã®ç—…é™¢
    <span style="color:orange;">â™£</span>ç²¾ç¥ç—…åºŠãŒ200åºŠä»¥ä¸Šã®ç—…é™¢
    <span style="color:green;">â– </span>çµæ ¸ç—…åºŠãŒã‚ã‚‹ç—…é™¢
    <span style="color:red;">â™ </span>æ„ŸæŸ“ç—…åºŠãŒã‚ã‚‹ç—…é™¢
    ã€å‡ºå…¸ã€‘<br>
    åŒ»ç™‚æƒ…å ±ãƒãƒƒãƒˆã®ã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼ˆåšç”ŸåŠ´åƒçœï¼‰<br>
    (2025å¹´12æœˆ1æ—¥æ™‚ç‚¹) <br>
    <a href="https://www.mhlw.go.jp/stf/seisakunitsuite/bunya/kenkou_iryou/iryou/newpage_43373.html" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation();">åšç”ŸåŠ´åƒçœã®åŒ»ç™‚ãƒšãƒ¼ã‚¸</a>
    &nbsp;&nbsp;&nbsp;
    <a href="https://www.digital.go.jp/resources/open_data/public_data_license_v1.0" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation();">åŒåˆ©ç”¨è¦ç´„</a><br>
    ä»‹è­·ã‚µãƒ¼ãƒ“ã‚¹æƒ…å ±ã®ã‚ªãƒ¼ãƒ—ãƒ³ãƒ‡ãƒ¼ã‚¿ï¼ˆåšç”ŸåŠ´åƒçœï¼‰<br>
    (2025å¹´12æœˆæœ«æ™‚ç‚¹)<br>
    <a href="https://www.mhlw.go.jp/stf/kaigo-kouhyou_opendata.html" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation();">åšç”ŸåŠ´åƒçœã®ä»‹è­·ãƒšãƒ¼ã‚¸</a>
    &nbsp;&nbsp;&nbsp;
    <a href="https://www.mhlw.go.jp/chosakuken/index.html" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation();">åŒåˆ©ç”¨è¦ç´„</a><br>
    e-Statå›½å‹¢èª¿æŸ»2020å¹´<br>
    ã€æ©Ÿèƒ½ã€‘<br>
    åœ°å›³ç¨®é¡å¤‰æ›´ã€åŒ»ç™‚åœå¢ƒç•Œç·šè¡¨ç¤º<br>
    æ–½è¨­é¸æŠï¼ˆå„ãƒšãƒ¼ã‚¸ã¸ãƒªãƒ³ã‚¯ï¼‰<br>
    æ¤œç´¢æ©Ÿèƒ½(andæ¤œç´¢)<br>
    andæ¤œç´¢ã®ä¾‹:å†…ç§‘ ç§‹è‘‰åŸã€€è¨ºç™‚æ‰€<br>
    äººå£è¡¨ç¤ºï¼ˆå¢ƒç•Œç·šè¡¨ç¤ºæ™‚ï¼‰<br>
    ã€åˆ©ç”¨è¦ç´„ãƒ»ã”æ„è¦‹ãƒ»ã”æ„Ÿæƒ³ãƒ»ãŠå•ã„åˆã‚ã›ã€‘<br>
    ä»–éƒ½é“åºœçœŒã¯ä¸‹è¨˜ã‚µã‚¤ãƒˆã¸<br>
    æœ¬ãƒ„ãƒ¼ãƒ«ã¯ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã§ä½œæˆã—ã¦ã„ã¾ã™ã€‚<br>
    <a href="https://sites.google.com/view/indexm" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation();">https://sites.google.com/view/indexm</a><br>
    ä½œæˆè€…:Mana48FanClub<br>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const colorMap = {"èµ¤": "red", "é’": "blue", "ã‚ªãƒ¬ãƒ³ã‚¸": "orange", "ç·‘": "green", "èŒ¶": "brown", "é»„": "yellow"};
    const shapeMap = {"ä¸€èˆ¬ç—…åºŠãŒ500åºŠä»¥ä¸Šã®ç—…é™¢": "star", "ç™‚é¤Šç—…åºŠãŒ100åºŠä»¥ä¸Šã®ç—…é™¢": "heart", "ç²¾ç¥ç—…åºŠãŒ200åºŠä»¥ä¸Šã®ç—…é™¢": "club", "çµæ ¸ç—…åºŠãŒã‚ã‚‹ç—…é™¢": "square", "æ„ŸæŸ“ç—…åºŠãŒã‚ã‚‹ç—…é™¢": "spade"};

    // 1. ãƒ¬ãƒ³ãƒ€ãƒ©ãƒ¼ã®åˆæœŸåŒ–ï¼ˆCanvasã‚’ä½¿ç”¨ï¼‰
    const myRenderer = L.canvas({ padding: 0.5 });

    // 2. ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼å®šç¾©ï¼ˆCanvasç›´æ¥æç”»ã§é«˜é€ŸåŒ–ï¼‰
    L.CustomMarker = L.CircleMarker.extend({
        _updatePath: function () {
            const ctx = this._renderer._ctx;
            const p = this._point;
            const r = this._radius;
            const s = this.options.shape;
            if (!this._renderer._drawing || this._empty()) return;

            ctx.fillStyle = this.options.fillColor;
            ctx.strokeStyle = this.options.color;
            ctx.lineWidth = this.options.weight;
            ctx.beginPath();

            if (s === 'star') {
                const rr = r * 1.8;   // starå°‚ç”¨ã‚µã‚¤ã‚º

                for (let i = 0; i < 5; i++) {

                    const outerX = p.x + rr * Math.cos((18+i*72)/180*Math.PI);
                    const outerY = p.y - rr * Math.sin((18+i*72)/180*Math.PI);

                    if (i === 0) {
                        ctx.moveTo(outerX, outerY);
                    } else {
                        ctx.lineTo(outerX, outerY);
                    }

                    ctx.lineTo(
                        p.x + (rr/2.2) * Math.cos((54+i*72)/180*Math.PI),
                        p.y - (rr/2.2) * Math.sin((54+i*72)/180*Math.PI)
                    );
                }
            } else if (s === 'heart') {
                ctx.moveTo(p.x, p.y + r*0.8);
                ctx.bezierCurveTo(p.x-r*1.5, p.y-r*0.8, p.x-r*0.5, p.y-r*1.8, p.x, p.y-r*0.6);
                ctx.bezierCurveTo(p.x+r*0.5, p.y-r*1.8, p.x+r*1.5, p.y-r*0.8, p.x, p.y+r*0.8);
            } else if (s === 'club') {
                ctx.arc(p.x, p.y-r*0.5, r*0.5, 0, Math.PI*2);
                ctx.arc(p.x-r*0.5, p.y+r*0.2, r*0.5, 0, Math.PI*2);
                ctx.arc(p.x+r*0.5, p.y+r*0.2, r*0.5, 0, Math.PI*2);
                ctx.moveTo(p.x, p.y); ctx.lineTo(p.x-r*0.2, p.y+r*0.8); ctx.lineTo(p.x+r*0.2, p.y+r*0.8);
            } else if (s === 'square') {
                ctx.rect(p.x - r*0.7, p.y - r*0.7, r*1.4, r*1.4);
            } else if (s === 'spade') {
                ctx.moveTo(p.x, p.y-r);
                ctx.bezierCurveTo(p.x+r*1.4, p.y+r*0.4, p.x+r*0.4, p.y+r*1.2, p.x, p.y+r*0.4);
                ctx.bezierCurveTo(p.x-r*0.4, p.y+r*1.2, p.x-r*1.4, p.y+r*0.4, p.x, p.y-r);
                ctx.moveTo(p.x, p.y+r*0.2); ctx.lineTo(p.x-r*0.2, p.y+r*0.8); ctx.lineTo(p.x+r*0.2, p.y+r*0.8);
            } else {
                ctx.arc(p.x, p.y, r, 0, Math.PI * 2);
            }
            ctx.closePath(); ctx.fill(); ctx.stroke();
        }
    });

    // 3. åœ°å›³åˆæœŸåŒ–
    const map = L.map('map', { 
        center: [34.710233985604596, 137.70251668848428], zoom: 15, preferCanvas: true, zoomControl: false 
    });

    // â˜…â†“â†“ ã“ã“ã«è¿½åŠ  â†“â†“

    function updateZoomIndicator() {
        const zoom = map.getZoom();
        document.getElementById('zoom-indicator').innerText = `Zoom: ${zoom}`;
    }

    // åˆæœŸè¡¨ç¤ºæ™‚ã«1å›å®Ÿè¡Œ
    updateZoomIndicator();

    // ã‚ºãƒ¼ãƒ å¤‰æ›´æ™‚ã«æ›´æ–°
    map.on('zoomend', updateZoomIndicator);

    // â˜…â†‘â†‘ ã“ã“ã¾ã§è¿½åŠ  â†‘â†‘    


    
    
    map.on('click', () => {
      closeControlsPanel();
    });
    
    const baseLayers = {
      "æ¨™æº–": L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 21, maxNativeZoom: 19 }),
      "å›½åœŸåœ°ç†é™¢åœ°å›³": L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', { maxZoom: 21, maxNativeZoom: 18 }),
      "èˆªç©ºå†™çœŸ": L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/seamlessphoto/{z}/{x}/{y}.jpg', { maxZoom: 21, maxNativeZoom: 18 })
    };
    baseLayers["æ¨™æº–"].addTo(map);
      const creditText = {
      "æ¨™æº–": "Â© OpenStreetMap",
      "èˆªç©ºå†™çœŸ": "Â© å›½åœŸåœ°ç†é™¢ï¼ˆèˆªç©ºå†™çœŸï¼‰",
      "å›½åœŸåœ°ç†é™¢åœ°å›³": "Â© å›½åœŸåœ°ç†é™¢"
    };

    const layerGroups = {};

    // 4. ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿é–¢æ•°ç¾¤
    function loadChome(idx) {
      fetch(`geo_0_ç”ºä¸ç›®å¢ƒç•Œ${idx}.geojson`)
        .then(res => res.json())
        .then(data => {

          layerGroups[`ç”ºä¸ç›®å¢ƒç•Œ${idx}`] = L.geoJSON(data, {
            renderer: myRenderer,

            style: {
              color: "red",
              weight: 1,
              fillOpacity: 0.03   // â˜… 0ã«ã—ãªã„ï¼ˆã‚¹ãƒãƒ›å¯¾ç­–ï¼‰
            },

            onEachFeature: (f, l) => {

              const content =
                `<strong>${f.properties["ç”ºä¸ç›®å"]}</strong><br>` +
                `äººå£ï¼š${f.properties["JINKO"] ?? "ä¸æ˜"}`;

              const isTouch = 'ontouchstart' in window;

              // ===== PCï¼šãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼ =====
              if (!isTouch) {
                l.bindTooltip(content, {
                  sticky: true,
                  opacity: 0.9,
                  direction: "auto"
                });
              }

              // ===== ã‚¹ãƒãƒ›ï¼šã‚¿ãƒƒãƒ— =====
              l.bindPopup(content);

              // ===== è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ =====
              l.on({
                mouseover: e => {
                  e.target.setStyle({
                    weight: 3,
                    color: "#ff0000",
                    fillOpacity: 0.15
                  });
                },

                mouseout: e => {
                  e.target.setStyle({
                    weight: 1,
                    color: "red",
                    fillOpacity: 0.03
                  });
                },

              });
            }
          });

        })
        .catch(err => console.error(err));
    }

    fetch("geo_99_1.geojson").then(res => res.json()).then(data => {
        layerGroups["ä¸€èˆ¬ç—…åºŠãŒ500åºŠä»¥ä¸Šã®ç—…é™¢"] = L.geoJSON(data, {
            pointToLayer: (f, latlng) => new L.CustomMarker(latlng, {
                renderer: myRenderer,
                radius: 12,
                shape: shapeMap["ä¸€èˆ¬ç—…åºŠãŒ500åºŠä»¥ä¸Šã®ç—…é™¢"] || "circle",
                fillColor: colorMap["èµ¤"] || "brown",
                color: "#fff",
                weight: 1.5,
                fillOpacity: 0.8
            }).bindPopup(
                `<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
                 ${f.properties["url2"] ? `<a href='${f.properties["url2"]}' target='_blank'>ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>` : ""}
                 ${f.properties["url"] ? ` | <a href='${f.properties["url"]}' target='_blank'>åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆ</a>` : ""}`,
                { maxWidth: 260 }  // â˜… ã“ã“ã§æ¨ªå¹…åˆ¶é™
            ),
            onEachFeature: (f, l) => {
                // ã‚¿ãƒƒãƒ—æ™‚ã«æ¤œç´¢ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹å‡¦ç†ã‚‚ã“ã“ã«è¿½åŠ å¯èƒ½
                l.on('click', () => {
                    // PCã§ã¯é–‰ã˜ãªã„ã€ã‚¹ãƒãƒ›ãªã‚‰é–‰ã˜ã‚‹
                    if('ontouchstart' in window) {
                        document.getElementById('search-panel').style.display = 'none';
                        document.getElementById('search-input').blur();
                    }
                });
            }
        });
    }).catch(e => {});
    
    fetch("geo_99_2.geojson").then(res => res.json()).then(data => {
        layerGroups["ç™‚é¤Šç—…åºŠãŒ100åºŠä»¥ä¸Šã®ç—…é™¢"] = L.geoJSON(data, {
            pointToLayer: (f, latlng) => new L.CustomMarker(latlng, {
                renderer: myRenderer,
                radius: 12,
                shape: shapeMap["ç™‚é¤Šç—…åºŠãŒ100åºŠä»¥ä¸Šã®ç—…é™¢"] || "circle",
                fillColor: colorMap["é’"] || "brown",
                color: "#fff",
                weight: 1.5,
                fillOpacity: 0.8
            }).bindPopup(
                `<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
                 ${f.properties["url2"] ? `<a href='${f.properties["url2"]}' target='_blank'>ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>` : ""}
                 ${f.properties["url"] ? ` | <a href='${f.properties["url"]}' target='_blank'>åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆ</a>` : ""}`,
                { maxWidth: 260 }  // â˜… ã“ã“ã§æ¨ªå¹…åˆ¶é™
            ),
            onEachFeature: (f, l) => {
                // ã‚¿ãƒƒãƒ—æ™‚ã«æ¤œç´¢ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹å‡¦ç†ã‚‚ã“ã“ã«è¿½åŠ å¯èƒ½
                l.on('click', () => {
                    // PCã§ã¯é–‰ã˜ãªã„ã€ã‚¹ãƒãƒ›ãªã‚‰é–‰ã˜ã‚‹
                    if('ontouchstart' in window) {
                        document.getElementById('search-panel').style.display = 'none';
                        document.getElementById('search-input').blur();
                    }
                });
            }
        });
    }).catch(e => {});
    
    fetch("geo_99_3.geojson").then(res => res.json()).then(data => {
        layerGroups["ç²¾ç¥ç—…åºŠãŒ200åºŠä»¥ä¸Šã®ç—…é™¢"] = L.geoJSON(data, {
            pointToLayer: (f, latlng) => new L.CustomMarker(latlng, {
                renderer: myRenderer,
                radius: 12,
                shape: shapeMap["ç²¾ç¥ç—…åºŠãŒ200åºŠä»¥ä¸Šã®ç—…é™¢"] || "circle",
                fillColor: colorMap["ã‚ªãƒ¬ãƒ³ã‚¸"] || "brown",
                color: "#fff",
                weight: 1.5,
                fillOpacity: 0.8
            }).bindPopup(
                `<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
                 ${f.properties["url2"] ? `<a href='${f.properties["url2"]}' target='_blank'>ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>` : ""}
                 ${f.properties["url"] ? ` | <a href='${f.properties["url"]}' target='_blank'>åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆ</a>` : ""}`,
                { maxWidth: 260 }  // â˜… ã“ã“ã§æ¨ªå¹…åˆ¶é™
            ),
            onEachFeature: (f, l) => {
                // ã‚¿ãƒƒãƒ—æ™‚ã«æ¤œç´¢ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹å‡¦ç†ã‚‚ã“ã“ã«è¿½åŠ å¯èƒ½
                l.on('click', () => {
                    // PCã§ã¯é–‰ã˜ãªã„ã€ã‚¹ãƒãƒ›ãªã‚‰é–‰ã˜ã‚‹
                    if('ontouchstart' in window) {
                        document.getElementById('search-panel').style.display = 'none';
                        document.getElementById('search-input').blur();
                    }
                });
            }
        });
    }).catch(e => {});
    
    fetch("geo_99_4.geojson").then(res => res.json()).then(data => {
        layerGroups["çµæ ¸ç—…åºŠãŒã‚ã‚‹ç—…é™¢"] = L.geoJSON(data, {
            pointToLayer: (f, latlng) => new L.CustomMarker(latlng, {
                renderer: myRenderer,
                radius: 12,
                shape: shapeMap["çµæ ¸ç—…åºŠãŒã‚ã‚‹ç—…é™¢"] || "circle",
                fillColor: colorMap["ç·‘"] || "brown",
                color: "#fff",
                weight: 1.5,
                fillOpacity: 0.8
            }).bindPopup(
                `<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
                 ${f.properties["url2"] ? `<a href='${f.properties["url2"]}' target='_blank'>ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>` : ""}
                 ${f.properties["url"] ? ` | <a href='${f.properties["url"]}' target='_blank'>åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆ</a>` : ""}`,
                { maxWidth: 260 }  // â˜… ã“ã“ã§æ¨ªå¹…åˆ¶é™
            ),
            onEachFeature: (f, l) => {
                // ã‚¿ãƒƒãƒ—æ™‚ã«æ¤œç´¢ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹å‡¦ç†ã‚‚ã“ã“ã«è¿½åŠ å¯èƒ½
                l.on('click', () => {
                    // PCã§ã¯é–‰ã˜ãªã„ã€ã‚¹ãƒãƒ›ãªã‚‰é–‰ã˜ã‚‹
                    if('ontouchstart' in window) {
                        document.getElementById('search-panel').style.display = 'none';
                        document.getElementById('search-input').blur();
                    }
                });
            }
        });
    }).catch(e => {});
    
    fetch("geo_99_5.geojson").then(res => res.json()).then(data => {
        layerGroups["æ„ŸæŸ“ç—…åºŠãŒã‚ã‚‹ç—…é™¢"] = L.geoJSON(data, {
            pointToLayer: (f, latlng) => new L.CustomMarker(latlng, {
                renderer: myRenderer,
                radius: 12,
                shape: shapeMap["æ„ŸæŸ“ç—…åºŠãŒã‚ã‚‹ç—…é™¢"] || "circle",
                fillColor: colorMap["èŒ¶"] || "brown",
                color: "#fff",
                weight: 1.5,
                fillOpacity: 0.8
            }).bindPopup(
                `<strong>${f.properties["å†…å®¹"] || "-"}</strong><br>
                 ${f.properties["url2"] ? `<a href='${f.properties["url2"]}' target='_blank'>ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸</a>` : ""}
                 ${f.properties["url"] ? ` | <a href='${f.properties["url"]}' target='_blank'>åŒ»ç™‚ãƒ»ä»‹è­·ãƒãƒƒãƒˆ</a>` : ""}`,
                { maxWidth: 260 }  // â˜… ã“ã“ã§æ¨ªå¹…åˆ¶é™
            ),
            onEachFeature: (f, l) => {
                // ã‚¿ãƒƒãƒ—æ™‚ã«æ¤œç´¢ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹å‡¦ç†ã‚‚ã“ã“ã«è¿½åŠ å¯èƒ½
                l.on('click', () => {
                    // PCã§ã¯é–‰ã˜ãªã„ã€ã‚¹ãƒãƒ›ãªã‚‰é–‰ã˜ã‚‹
                    if('ontouchstart' in window) {
                        document.getElementById('search-panel').style.display = 'none';
                        document.getElementById('search-input').blur();
                    }
                });
            }
        });
    }).catch(e => {});
    
    // åˆæœŸèª­ã¿è¾¼ã¿å®Ÿè¡Œ
    for(let i=1; i<=0; i++) { loadChome(i.toString().padStart(2, '0')); }

    document.querySelectorAll('.layer-toggle').forEach(cb => {
        cb.addEventListener('change', function() {
            const g = layerGroups[this.value];
            if (!g) return;
            if (this.checked) {
                g.addTo(map);
                
                // â˜… ã‚ºãƒ¼ãƒ å¤‰æ›´ã§ã‚ºãƒ¬ãŸåº§æ¨™ã‚’ã€ç¾åœ¨ã®åœ°å›³ã«åˆã‚ã›ã¦å¼·åˆ¶è¨ˆç®—ã—ç›´ã™
                setTimeout(() => {
                    if (g.eachLayer) {
                        g.eachLayer(layer => {
                            // ãƒãƒ¼ã‚«ãƒ¼ï¼ˆç—…é™¢ãªã©ï¼‰ã®å ´åˆï¼šåº§æ¨™ã‚’ä¸Šæ›¸ãã—ã¦å†æç”»ã‚’ä¿ƒã™
                            if (layer.getLatLng && layer.setLatLng) {
                                layer.setLatLng(layer.getLatLng());
                            } 
                            // å¢ƒç•Œç·šï¼ˆç”ºä¸ç›®ãªã©ï¼‰ã®å ´åˆï¼šã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°ã—ã¦å†æç”»ã‚’ä¿ƒã™
                            else if (layer.setStyle) {
                                layer.setStyle({});
                            }
                        });
                    }
                    // ã‚­ãƒ£ãƒ³ãƒã‚¹å…¨ä½“ã®ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥
                    // â˜…â˜…if (myRenderer) myRenderer.redraw();
                }, 10); 
            } else {
                map.removeLayer(g);
            }
        });
    });

    // æ¤œç´¢æ©Ÿèƒ½
    document.getElementById('search-input').oninput = function(e) {
        const val = e.target.value.toLowerCase().trim();
        const resDiv = document.getElementById('search-results');
        resDiv.innerHTML = '';
        if(!val) return;
        const keywords = val.split(/[\sã€€]+/);
        for (let label in layerGroups) {
            if (label.includes("ç”ºä¸ç›®å¢ƒç•Œ") || !layerGroups[label]) continue;
            layerGroups[label].eachLayer(l => {
                const name = (l.feature.properties["å†…å®¹"] || "").toLowerCase();
                if(keywords.every(kw => name.includes(kw))) {
                    const item = document.createElement('div');
                    item.className = "search-item";
                    item.style = "padding:8px; border-bottom:1px solid #eee; font-size:13px;";
                    item.innerText = l.feature.properties["å†…å®¹"];
                    item.onclick = () => {

                        const layer = layerGroups[label];

                          // â‘¡ æ¤œç´¢ãƒ‘ãƒãƒ«ã‚’é–‰ã˜ã‚‹
                          const searchPanel = document.getElementById('search-panel');
                          searchPanel.style.display = 'none';

                          // â‘¢ æ¤œç´¢å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢ã¯ä»Šå›ã¯ä¸­æ­¢ã—ã¾ã™
                          const searchInput = document.getElementById('search-input');
                          // æ¤œç´¢çµæœã®ã‚¯ãƒªã‚¢ä¸­æ­¢const searchResults = document.getElementById('search-results');
                          // æ¤œç´¢æ–‡å­—ã®ã‚¯ãƒªã‚¢ä¸­æ­¢searchInput.value = '';
                          // æ¤œç´¢ã®ä¸­æ­¢searchResults.innerHTML = '';

                          // â˜… ãã®ãƒãƒ¼ã‚«ãƒ¼ã ã‘è¡¨ç¤º
                          if (!map.hasLayer(l)) {
                              l.addTo(map);
                          }

                          // â‘£ â˜… ã‚½ãƒ•ãƒˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’ç¢ºå®Ÿã«é–‰ã˜ã‚‹ï¼ˆè¶…é‡è¦ï¼‰
                          searchInput.blur();
                                                
                          // â‘¤ ã‚ºãƒ¼ãƒ ã—ãªã„ï¼†ç§»å‹•
                          map.panTo(l.getLatLng(), {
                              animate: true
                          });

                          // â‘¥ æç”»å®Œäº†å¾Œã« popup ã‚’é–‹ãï¼ˆã‚¹ãƒãƒ›å®‰å®šï¼‰
                          setTimeout(() => {
                              l.openPopup();
                          }, 250);
                      };
                    resDiv.appendChild(item);
                }
            });
        }
    };

    function togglePanel(id) {
        const p = document.getElementById(id);
        const isVisible = p.style.display === 'block';
        ['controls', 'search-panel', 'info-panel'].forEach(i => document.getElementById(i).style.display = 'none');
        if(!isVisible) p.style.display = 'block';
    }

    document.getElementById('selectAllBtn').onclick = () => {
        document.querySelectorAll('.layer-toggle').forEach(cb => { cb.checked = true; cb.dispatchEvent(new Event('change')); });
    };
    document.getElementById('deselectAllBtn').onclick = () => {
        document.querySelectorAll('.layer-toggle').forEach(cb => { cb.checked = false; cb.dispatchEvent(new Event('change')); });
    };

    document.querySelectorAll('input[name="baseLayer"]').forEach(radio => {
      radio.addEventListener('change', function() {

        // ãƒ™ãƒ¼ã‚¹ãƒ¬ã‚¤ãƒ¤ãƒ¼åˆ‡æ›¿
        for (let key in baseLayers) {
          map.removeLayer(baseLayers[key]);
        }
        baseLayers[this.value].addTo(map);

        // â˜… ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆè¡¨ç¤ºåˆ‡æ›¿
        const credit = creditText[this.value] || "";
        document.getElementById("credit-title").innerText = credit;
      });
    });

    function closeControlsPanel() {
      const controls = document.getElementById('controls');
      if (controls && controls.style.display === 'block') {
        controls.style.display = 'none';
      }
    }

  </script>
</body>
</html>
